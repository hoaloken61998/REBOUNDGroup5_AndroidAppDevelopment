<div class="form-container">
  <h1>Order Details</h1>
  <ng-container *ngIf="order(); else noOrderFound">
    <fieldset>
      <!-- Customer Information -->
      <div>
        <h2>Customer Information</h2>
        <label><strong>Customer Name:</strong></label>
        <p>{{ customer()?.FullName || 'N/A' }}</p>
        <label><strong>Phone Number:</strong></label>
        <p>{{ customer()?.PhoneNumber || 'N/A' }}</p>
        <label><strong>Email:</strong></label>
        <p>{{ customer()?.Email || 'N/A' }}</p>
        <!-- As there's no 'Address' field in provided Firebase User/Order structure, it's kept static or N/A -->
        <label><strong>Address:</strong></label>
        <p>123 Main Street, Hanoi (Static/N/A from DB)</p>
        <label><strong>Special Note/Request:</strong></label>
        <p>Please deliver before 6 PM. (Static/N/A from DB)</p>
      </div>
      
      <!-- Product Information -->
      <h2>Product List</h2>
      <table>
        <thead>
          <tr>
            <th>Product Name</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Sub Total</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of displayOrderItems()">
            <td>{{ item.ProductName }}</td> <!-- Đảm bảo hiển thị ProductName -->
            <td>{{ item.Quantity }}</td>
            <td>{{ formatCurrency(item.UnitPrice) }}</td> <!-- Đảm bảo hiển thị UnitPrice -->
            <td>{{ formatCurrency(item.ItemSubTotal) }}</td>
          </tr>
          <tr *ngIf="displayOrderItems().length === 0">
            <td colspan="4" style="text-align: center;">No products in this order.</td>
          </tr>
        </tbody>
      </table>
      <label><strong>Delivery Fee:</strong></label>
      <p>{{ formatCurrency(order()?.DeliveryFee) }}</p>
      <label><strong>Discount Value:</strong></label>
      <p>{{ order()?.DiscountValue ? (order()!.DiscountValue * 100) + '%' : '0%' }}</p>
      <label><strong>Subtotal:</strong></label>
      <p>{{ formatCurrency(order()?.Subtotal) }}</p>
      <label><strong>Total Amount:</strong></label>
      <p>{{ formatCurrency(order()?.TotalAmount) }}</p>
      
      <!-- Order Specifics -->
      <label><strong>Order Date:</strong></label>
      <p>{{ order()?.OrderDate || 'N/A' }}</p>
      <label><strong>Payment Method ID:</strong></label>
      <p>{{ order()?.PaymentMethodID || 'N/A' }}</p>
      <label><strong>User Promotion:</strong></label>
      <p>{{ order()?.UserPromotion || 'N/A' }}</p>

      <!-- Order Status -->
      <div class="order-status">
        <strong>Order Status:</strong> 
        <span [ngClass]="{
          'status-confirmed': order()?.Status === 'Confirmed',
          'status-cancelled': order()?.Status === 'Cancelled',
          'status-pending': order()?.Status === 'Pending'
        }">
          {{ order()?.Status || 'N/A' }}
        </span>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="btn back-button" (click)="goBack()">Back</button>
        <button class="btn" (click)="confirmOrder()" *ngIf="order()?.Status !== 'Confirmed' && order()?.Status !== 'Cancelled'">Confirm Order</button>
        <button class="btn cancel-button" (click)="cancelOrder()" *ngIf="order()?.Status !== 'Cancelled' && order()?.Status !== 'Confirmed'">Cancel Order</button>
      </div>
    </fieldset>
  </ng-container>

  <ng-template #noOrderFound>
    <p>Loading order details or order not found...</p>
  </ng-template>
</div>
